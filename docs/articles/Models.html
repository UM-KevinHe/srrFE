<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Models • srrFE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Models">
<meta property="og:description" content="srrFE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-54921687-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-54921687-5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">srrFE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/srrFE.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Models.html">Models</a>
    </li>
    <li>
      <a href="../articles/Quick-start.html">Quick Start</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/UM-KevinHe/srrFE/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Models</h1>
                        <h4 data-toc-skip class="author">Yubo Shao</h4>
            
            <h4 data-toc-skip class="date"><span style="font-style:normal;font-family:'Open Sans'">2023-12-16</span></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/UM-KevinHe/srrFE/blob/HEAD/vignettes/Models.Rmd"><code>vignettes/Models.Rmd</code></a></small>
      <div class="hidden name"><code>Models.Rmd</code></div>

    </div>

    
    
<style>
body {
  text-align: justify
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction:<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In the upcoming section, we will use two simulated datasets to illustrate the fundamental utilization of the relevant functions within the SRR fixed effect model.</p>
<p>Both datasets are simulated by the <code>sim.fe.prov()</code> function contained in the current package, which include information of:</p>
<ul>
<li><p>10 facilities</p></li>
<li><p>4 continuous variables</p></li>
<li><p>1 binary outcome</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#number of facilities</span></span>
<span><span class="va">prov.size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10</span><span class="op">)</span> <span class="co">#each facility has 50 records</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span> <span class="co">#facility effects follow N(0, 1)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">Y.char</span> <span class="op">&lt;-</span> <span class="st">"Y"</span></span>
<span><span class="va">Z.char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z1"</span>, <span class="st">"Z2"</span>, <span class="st">"Z3"</span>, <span class="st">"Z4"</span><span class="op">)</span></span>
<span><span class="va">prov.char</span> <span class="op">&lt;-</span> <span class="st">"Prov.ID"</span></span>
<span><span class="va">data_normal</span> <span class="op">&lt;-</span> <span class="fu">sim.fe.prov</span><span class="op">(</span><span class="va">m</span>, <span class="va">prov.size</span>, <span class="va">gamma</span>, <span class="va">beta</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, rho <span class="op">=</span> <span class="fl">0.2</span>, method <span class="op">=</span> <span class="st">"KW2013"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_normal</span><span class="op">)</span></span></code></pre></div>
<p>The second dataset includes facilities that are outliers, meaning that certain facilities either have no readmissions or have all their readmissions occurring after discharge.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co">#the first two facilities are "outliers"</span></span>
<span><span class="va">data_outlier</span> <span class="op">&lt;-</span> <span class="fu">sim.fe.prov</span><span class="op">(</span><span class="va">m</span>, <span class="va">prov.size</span>, <span class="va">gamma</span>, <span class="va">beta</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, rho <span class="op">=</span> <span class="fl">0.2</span>, method <span class="op">=</span> <span class="st">"KW2013"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_outlier</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation-function">Data Preparation Function<a class="anchor" aria-label="anchor" href="#data-preparation-function"></a>
</h2>
<p>We will start by using the <code>fe.data.prep()</code> function to prepare the necessary data structure for our function. The original data is processed in the following sequence:</p>
<ul>
<li><p>checking absence of response variable, covariates, facility and hospital identifiers</p></li>
<li><p>checking missing values in these variables,</p></li>
<li><p>facility screening based on number of discharges, 10 as default,</p></li>
<li><p>calculating the total number of facilities and hospitals,</p></li>
<li><p>reporting proportions of facilities with no readmission within 30 days, and with all readmissions within 30 days after discharge,</p></li>
<li><p>modifying responses to prevent infinite log-likelihoods during model fitting, and</p></li>
<li><p>sorting data by hospital and facility identifiers.</p></li>
</ul>
<p>This function will return a data frame sorted by provider IDs with additional variables ‘included’, ‘no.readm’, ‘all.readm’ and missing values imputed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_normal</span> <span class="op">&lt;-</span> <span class="fu">fe.data.prep</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_normal</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_outlier</span> <span class="op">&lt;-</span> <span class="fu">fe.data.prep</span><span class="op">(</span><span class="va">data_outlier</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_outlier</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimation-function">Estimation Function<a class="anchor" aria-label="anchor" href="#estimation-function"></a>
</h2>
<div class="section level3">
<h3 id="coefficients-estimation">Coefficients Estimation<a class="anchor" aria-label="anchor" href="#coefficients-estimation"></a>
</h3>
<p>The <code>logis.BIN.fe.prov()</code> is the parameter estimation function, which performs the SerBIN method as introduced by Wu et al. (2022).</p>
<p>The algorithm is based on Newton-Raphson. Shortly, for a binary outcome, the likelihood function can be expressed as: <span class="math display">\[l(\gamma, \beta) = \sum_{i = 1}^m \sum_{j = 1}^{n_i}\{Y_{ij} \cdot (\gamma_i + X_{ij}\beta) - log(1 + e^{\gamma_i + X_{ij}\beta})\},\]</span> and the corresponding score function can be expressed as: <span class="math display">\[U(\gamma_i) = \sum_{j = 1}^{n_i} \{Y_{ij} - \frac{e^{\gamma_i + X_{ij}\beta}}{1 + e^{\gamma_i + X_{ij}\beta}}\}\]</span> <span class="math display">\[U(\beta_p) = \sum_{i = 1}^m \sum_{j = 1}^{n_i} \{X_{ijp} \cdot (Y_{ij} - \frac{e^{\gamma_i + X_{ij}\beta}}{1 + e^{\gamma_i + X_{ij}\beta}})\}.\]</span> The information matrix can be seen as a <span class="math inline">\(2 \times 2\)</span> block matrix with <span class="math display">\[ I(\gamma, \beta) = \begin{pmatrix} I(\gamma) &amp; I(\gamma, \beta)   \\   I(\beta, \gamma) &amp; I(\beta)  \end{pmatrix} \equiv \begin{pmatrix} I_{11} &amp; I_{12} \\ I_{21} &amp; I_{22}  \end{pmatrix}.\]</span> Notice that <span class="math inline">\(I(\gamma)\)</span> block is “large” but diagonal, therefore we can calculate <span class="math inline">\(I^{-1}(\gamma, \beta)\)</span> by: <span class="math display">\[I^{-1}(\gamma, \beta) = \begin{pmatrix} I_{11}^{-1} + {J_1}^{T} S^{-1} J_1 &amp; - {J_2}^{T}   \\   - {J_2} &amp;  S^{-1}  \end{pmatrix},\]</span> where <span class="math inline">\(J_1 = I_{21}{I_{11}}^{-1}\)</span>, <span class="math inline">\(S = I_{22} - J_1 I_{12}\)</span>, and <span class="math inline">\(J_2 = S^{-1}J_1\)</span>.</p>
<p>The bottleneck of SerBIN is computing <span class="math inline">\(I_{22}\)</span> (i.e. <span class="math inline">\(I(\beta)\)</span>) when sample size <span class="math inline">\(n\)</span> is extraordinarily large, but in fact each element of <span class="math inline">\(I_{22}\)</span> can be computed separately, such that parallel computing can be used to boost computational efficiency:</p>
<p><span class="math display">\[I(\beta)_{r,c} = &lt;X^{(r)}, X^{(c)} \circ \mathbb{I}&gt;,\]</span> where <span class="math inline">\(&lt;a, b&gt;\)</span> denotes the inner product of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> (i.e. <span class="math inline">\(a^T b\)</span>), <span class="math inline">\(\circ\)</span> is the Hadamard product (element-wise product), and <span class="math inline">\(\mathbb{I} = p(1-p)\)</span>. Note that <span class="math inline">\(I(\beta)\)</span> is symmetric, so we only need to calculate the upper triangular entries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.SerBIN.indirect</span> <span class="op">&lt;-</span> <span class="fu">logis.BIN.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, </span>
<span>                                         SRR <span class="op">=</span> <span class="st">"indirect"</span>, rate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">fit.SerBIN.indirect</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">fit.SerBIN.indirect</span><span class="op">$</span><span class="va">df.prov</span><span class="op">$</span><span class="va">gamma</span></span></code></pre></div>
<p>Outlier facilities will have their facility effects labeled as either “Inf” or “-Inf”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.SerBIN.direct</span> <span class="op">&lt;-</span> <span class="fu">logis.BIN.fe.prov</span><span class="op">(</span><span class="va">data_outlier</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, </span>
<span>                                       SRR <span class="op">=</span> <span class="st">"direct"</span>, rate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">fit.SerBIN.direct</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="va">fit.SerBIN.direct</span><span class="op">$</span><span class="va">df.prov</span><span class="op">$</span><span class="va">gamma</span></span></code></pre></div>
<p>In fact, to prevent the gamma estimate from exploding (or unstable) in our code, we constrain the <span class="math inline">\({\hat{\gamma}}^{[l]}\)</span> within a specific range during each iteration. By default, this range is <span class="math inline">\({\hat{\gamma}_{med}}^{[l-1]} \pm 10\)</span>. As a result, the final <span class="math inline">\(\hat{\gamma}\)</span> estimate of outlying facility will not truly be <span class="math inline">\(\pm \infty\)</span>. We modify them manually.</p>
</div>
<div class="section level3">
<h3 id="standardized-readmission-ratio-srr">Standardized readmission ratio (SRR)<a class="anchor" aria-label="anchor" href="#standardized-readmission-ratio-srr"></a>
</h3>
<p>In addition to the covariate coefficients and the facility effects outputs, users can specify the method (“direct” or “indirect” standardization) for computing facility-level SRR, where</p>
<ul>
<li>
<strong>“Indirect standardization ratio”</strong> is calculated by</li>
</ul>
<p><span class="math display">\[SRR_i = \frac{O_i}{E_i},\]</span> where <span class="math inline">\(O_i\)</span> is the observed number of readmission for facility <span class="math inline">\(i\)</span> (i.e. <span class="math inline">\(O_i = \sum_{j = 1}^{n_i} Y_{ij}\)</span>), and <span class="math inline">\(E_i\)</span> is the expected number of readmission for facility <span class="math inline">\(i\)</span> that is calculated by <span class="math inline">\(E_i = \sum_{j = 1}^{n_i} \frac{e^{\gamma_0 + X_{ij}\beta}}{1 + e^{\gamma_0 + X_{ij}\beta}}\)</span>. <span class="math inline">\(\gamma_0\)</span> is the “national norm”, and in default, it is set to be the median value of all <span class="math inline">\(\hat{\gamma}_i\)</span>’s. <span class="math inline">\(SRR_i &gt;1\)</span> indicates that the facility <span class="math inline">\(i\)</span> has a rate of readmission higher than would be expected based on patient characteristics and the national norm.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.SerBIN.indirect</span><span class="op">$</span><span class="va">df.prov</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<ul>
<li>
<strong>“Direct standardization ratio”</strong> is calculated by</li>
</ul>
<p><span class="math display">\[\hat{SRR}^{(k)} = \frac{E^{(k)}}{O},\]</span> where <span class="math inline">\(O = \sum_{i = 1}^m O_i\)</span>, and <span class="math inline">\(E^{(k)} = \sum_{i = 1}^m \sum_{j = 1}^{n_i} \frac{e^{\hat{\gamma}_k + X_{ij}\beta}}{1 + e^{\hat{\gamma}_k + X_{ij}\beta}}\)</span>. Note: (1) the “hat” symbol in <span class="math inline">\(\hat{SRR}^{(k)}\)</span> comes from <span class="math inline">\(\hat{\gamma}_k\)</span>, which is the estimated value of <span class="math inline">\(\gamma_k\)</span>. (2) When <span class="math inline">\(\hat{\gamma}_k = \infty\)</span>, <span class="math inline">\(E^{(k)} = N\)</span> such that <span class="math inline">\(\hat{SRR}^{(k)} = \frac{N}{O}\)</span>; and when <span class="math inline">\(\hat{\gamma}_k = -\infty\)</span>, <span class="math inline">\(E^{(k)} = 0\)</span> such that <span class="math inline">\(\hat{SRR}^{(k)} = 0\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.SerBIN.direct</span><span class="op">$</span><span class="va">df.prov</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<p>Users also have the option to request the function to provide a “standardization rate”, which is computed as <span class="math inline">\(SRR \times \frac{O}{N}\)</span>. Note that the “indirect rate” has been manually restricted to <span class="math inline">\(0\% - 100\%\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.SerBIN.indirect</span><span class="op">$</span><span class="va">df.prov</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">fit.SerBIN.direct</span><span class="op">$</span><span class="va">df.prov</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hypothesis-testing-function">Hypothesis Testing Function<a class="anchor" aria-label="anchor" href="#hypothesis-testing-function"></a>
</h2>
<p>The <code>test.fe.prov()</code> function provides hypothesis testing outcomes to assist users in identifying outlier providers with extreme outcomes. By default, we utilize the median of all estimated facility effects as the null value (i.e. <span class="math inline">\(H_0: \gamma_i = \hat{\gamma}_{med}\)</span>). Users have the flexibility to select from various testing methods, including “exact.poisbinom” (default), “exact.binom”, “exact.bootstrap”, “score”, and “wald”.</p>
<ul>
<li><p><strong>“exact.poisbinom”</strong>: Suppose <span class="math inline">\(Y_{ij}|X_{ij} \sim Bernoulli(p_{ij})\)</span>. Since within the facility <span class="math inline">\(i\)</span>, <span class="math inline">\(p_{ij} = \frac{e^{\gamma_i + X_{ij}\beta}}{1 + e^{\gamma_i + X_{ij}\beta}}\)</span>’s are different, then <span class="math inline">\(O_i | X_i = \sum_{j = 1}^{n_i}Y_{ij}\)</span> will follow the Poisson-binomial distribution. Then we calculate the probability of “getting a more extreme number of <span class="math inline">\(O_i\)</span>, if <span class="math inline">\(H_0\)</span> is true” based on the Poisson-binomial distribution.</p></li>
<li><p><strong>“exact.binom”</strong>: Find <span class="math inline">\(p_{ij}\)</span>’s first, then compute <span class="math inline">\(\bar{p_i} = \frac{\sum_{j = 1}^{n_i} p_{ij}}{n_i}\)</span>. Assume <span class="math inline">\(O_i | X_i \sim Binomial(n_i, \bar{p_i})\)</span> and perform the exact test as above.</p></li>
</ul>
<p><em>[Source code]</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exact.binom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">gamma.null</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">Z.char</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="va">Y.char</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">pbinom</a></span><span class="op">(</span><span class="va">obs</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">dbinom</a></span><span class="op">(</span><span class="va">obs</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">z.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">p</span>, lower<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span>  <span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span><span class="op">&lt;</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span><span class="op">&lt;=</span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p.val</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">flag</span>, <span class="va">p.val</span>, <span class="va">z.score</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<ul>
<li><p><strong>“exact.bootstrap”</strong>: (1)Repeat <span class="math inline">\(b =\)</span> 10,000 times (default): Simulate <span class="math inline">\({Y_{ij}}^{(b)} \sim Bernoulli(\frac{e^{\gamma_0 + X_{ij}\beta}}{1 + e^{\gamma_0 + X_{ij}\beta}})\)</span> and <span class="math inline">\({Y_{i}}^{(b)} = \sum_{j = 1}^{n_i} {Y_{ij}}^{(b)}\)</span>. (2) Calculate the frequency that <span class="math inline">\({Y_{i}}^{(b)}\)</span> is more extreme than <span class="math inline">\(O_i\)</span>. (3) calculate <span class="math inline">\(p-\)</span>value. (Note: “Exact Bootstrap” is consistent to “Exact Poisbinom”)</p></li>
<li><p><strong>“wald”</strong>: If <span class="math inline">\(H_0: \gamma_i = \gamma_0\)</span> is true, <span class="math inline">\(\frac{\hat{\gamma}_i - \gamma_0}{se(\hat{\gamma}_i)} \sim N(0, 1)\)</span>. The <span class="math inline">\(se(\hat{\gamma}_i)\)</span> can be calculated by above <span class="math inline">\(I_{11}^{-1} + {J_1}^{T} S^{-1} J_1\)</span> but with only diagonal elements.</p></li>
</ul>
<p>Note that the “Wald test” is not valid for outlying facilities (i.e. <span class="math inline">\(\hat{\gamma}_i = \pm \infty\)</span>). “Error message” is added in the code to inform users.</p>
<p><em>[Source code]</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"wald test cannot be performed on facilities with zero or all readmissions!!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>
<strong>“score”</strong>: Problematic. In a standard score test procedure, the initial step involves computing the “restricted MLE” of <span class="math inline">\(\hat{\beta}^*\)</span>. Then calculate <span class="math inline">\(U(\gamma_i)|_{\gamma_i = \gamma_0} = \sum_{j = 1}^{n_i} \{Y_{ij} - \frac{e^{\gamma_0 + X_{ij}\hat{\beta}^*}}{1 + e^{\gamma_0 + X_{ij}\hat{\beta}^*}}\}\)</span>, and <span class="math inline">\(I(\gamma_i)|_{\gamma_i = \gamma_0} = \sum_{j = 1}^{n_i} \{\frac{e^{\gamma_0 + X_{ij}\hat{\beta}^*}}{(1 + e^{\gamma_0 + X_{ij}\hat{\beta}^*})^2}\}\)</span>. Since estimation of <span class="math inline">\({\beta}\)</span>’s are affected by the estimation pf <span class="math inline">\(\gamma\)</span>’s, generally <span class="math inline">\(\hat{\beta}^* \neq \hat{\beta}\)</span>.</li>
</ul>
<p>However, the original code doesn’t refit the models, but directly use <span class="math inline">\(\hat{\beta}\)</span>. On the other hand, if we refit the models, because we have thousands of facilities to be tested, it’s impossible to refit thousands of new models.</p>
<p><em>[Source code]</em></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">gamma.null</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">Z.char</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">z.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">Y.char</span><span class="op">]</span> <span class="op">-</span> <span class="va">probs</span>, <span class="va">data</span><span class="op">[</span>, <span class="va">prov.char</span><span class="op">]</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">probs</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">probs</span><span class="op">)</span>, <span class="va">data</span><span class="op">[</span>, <span class="va">prov.char</span><span class="op">]</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">z.score</span>, lower <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">flag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">0</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p.val</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>Here are examples for “testing” code. The “flag” column contains values of -1, 0, and 1, which respectively indicate facilities performing worse, the same as, or better than the national average. The “p” and “stat” columns in the data frame correspond to the p-value and Z-score of the test statistic, respectively.</p>
<p>We can see that the testing results are almost the same.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.exact.poisbinom</span> <span class="op">&lt;-</span> <span class="fu">test.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">fit.SerBIN.indirect</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, test <span class="op">=</span> <span class="st">"exact.poisbinom"</span><span class="op">)</span></span>
<span><span class="va">test.exact.poisbinom</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.wald</span> <span class="op">&lt;-</span> <span class="fu">test.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">fit.SerBIN.indirect</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, test <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span></span>
<span><span class="va">test.wald</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.exact.bootstrap</span> <span class="op">&lt;-</span> <span class="fu">test.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">fit.SerBIN.indirect</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, test <span class="op">=</span> <span class="st">"exact.bootstrap"</span><span class="op">)</span></span>
<span><span class="va">test.exact.bootstrap</span></span></code></pre></div>
<p>Even the “problematic” score test also provides a similar result:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.exact.score</span> <span class="op">&lt;-</span> <span class="fu">test.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">fit.SerBIN.indirect</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, test <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></span>
<span><span class="va">test.exact.score</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="confidence-interval-function">Confidence Interval Function<a class="anchor" aria-label="anchor" href="#confidence-interval-function"></a>
</h2>
<p>The <code>confint.fe.prov()</code> function provides the confidence intervals for the SRRs and facility effects for each facilities selected to be tested. users can choose the method for generating confidence intervals from the following options:</p>
<ul>
<li>
<strong>“exact”</strong>: Based on the Poisson binomial distribution of <span class="math inline">\(O_i|X_i\)</span>, find the range of <span class="math inline">\(\gamma_0\)</span> such that <span class="math inline">\(P_{exact} \geq 0.05\)</span>.</li>
</ul>
<p><em>[Source code]</em></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CL.finite</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">UL.gamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Gamma</span><span class="op">)</span></span>
<span>    <span class="fu">poibin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/poibin/man/ppoibin.html" class="external-link">ppoibin</a></span><span class="op">(</span><span class="va">Obs</span> <span class="op">-</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">Gamma</span> <span class="op">+</span> <span class="va">Z.beta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fl">0.5</span> <span class="op">*</span> <span class="fu">poibin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/poibin/man/ppoibin.html" class="external-link">dpoibin</a></span><span class="op">(</span><span class="va">Obs</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">Gamma</span> <span class="op">+</span> <span class="va">Z.beta</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">LL.gamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Gamma</span><span class="op">)</span></span>
<span>    <span class="fl">1</span> <span class="op">-</span> <span class="fu">poibin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/poibin/man/ppoibin.html" class="external-link">ppoibin</a></span><span class="op">(</span><span class="va">Obs</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">Gamma</span> <span class="op">+</span> <span class="va">Z.beta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fl">0.5</span> <span class="op">*</span> <span class="fu">poibin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/poibin/man/ppoibin.html" class="external-link">dpoibin</a></span><span class="op">(</span><span class="va">Obs</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">Gamma</span> <span class="op">+</span> <span class="va">Z.beta</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">prov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">prov.char</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">prov.char</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Number of providers involved NOT equal to one!"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Z.beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">Z.char</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">gamma.lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">uniroot</a></span><span class="op">(</span><span class="va">LL.gamma</span>, <span class="va">gamma</span><span class="op">[</span><span class="va">prov</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">root</span></span>
<span>  <span class="va">gamma.upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">uniroot</a></span><span class="op">(</span><span class="va">UL.gamma</span>, <span class="va">gamma</span><span class="op">[</span><span class="va">prov</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">root</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It’s important to note that we must numerically find the endpoints of the confidence interval, which involves locating the roots of an equation. However, we should be careful as this range can depend on the data. In some instances, searching within <span class="math inline">\(\hat{\gamma}_i \pm 5\)</span> (default) may not be sufficient! (e.g. when <span class="math inline">\(\hat{\gamma}_i\)</span> is large but not <span class="math inline">\(\pm \infty\)</span>)</p>
<p>The diagram below illustrates the root search process. The point where the blue line intersects with the line <span class="math inline">\(y = 0\)</span> represents the root, while the shaded green region indicates the search range.</p>
<ul>
<li><p><strong>“wald”</strong>: Directly convert <span class="math inline">\(\hat{\gamma}_i \pm 1.96 \times se(\hat{\gamma}_i)\)</span>, which is invalid for outlying facilities.</p></li>
<li><p><strong>“score”</strong>: Find the range of <span class="math inline">\(\gamma_0\)</span> such that <span class="math inline">\(\frac{U(\gamma_i)|_{\gamma_i = \gamma_0}}{\sqrt{I(\gamma_i)|_{\gamma_i = \gamma_0}}} \in (-1.96, 1.96)\)</span>. The problem for score test still exist (even more serious).</p></li>
</ul>
<p>This is the confidence interval provided using the exact test:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confint.exact</span> <span class="op">&lt;-</span> <span class="fu">confint.fe.prov</span><span class="op">(</span><span class="va">data_normal</span>, <span class="va">fit.SerBIN.indirect</span>, <span class="va">Y.char</span>, <span class="va">Z.char</span>, <span class="va">prov.char</span>, test<span class="op">=</span><span class="st">"exact"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">confint.exact</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>We can also calculate the confidence interval for SRR based on the confidence interval for <span class="math inline">\(\gamma_i\)</span>. In the context of indirect standardization, the interpretation of the confidence interval for SRR is as follows: If <span class="math inline">\(SRR_i = 1\)</span> holds true, then <span class="math inline">\((1 - \alpha)\%\)</span> of the confidence intervals will cover the value 1.</p>
<p>Since the score equation tells us <span class="math inline">\(O_i = \sum_{j = 1}^{n_i} \frac{e^{\hat{\gamma}_i + X_{ij}\hat{\beta}}}{1 + e^{\hat{\gamma}_i + X_{ij}\hat{\beta}}}\)</span>, the CI of SRR can be calculated as: <span class="math display">\[(\sum_{j = 1}^{n_i} \frac{e^{\gamma_{i,L} + X_{ij}\hat{\beta}}}{1 + e^{\gamma_{i,L} + X_{ij}\hat{\beta}}}, \sum_{j = 1}^{n_i} \frac{e^{\gamma_{i,U} + X_{ij}\hat{\beta}}}{1 + e^{\gamma_{i,U} + X_{ij}\hat{\beta}}}).\]</span> This formula holds since <span class="math inline">\(\gamma_{i, CI}\)</span> covers <span class="math inline">\(\gamma_0\)</span> if and only if <span class="math inline">\(SRR_{i, CI}\)</span> covers <span class="math inline">\(1\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confint.exact</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre></div>
<p>For direct standardization, the interpretation of the confidence interval for SRR is: If <span class="math inline">\(\gamma_k = \gamma_0\)</span> is true, then <span class="math inline">\((1 - \alpha)\%\)</span> of the confidence intervals of <span class="math inline">\(SRR^{(k)}\)</span> will cover <span class="math inline">\(SRR^{(0)}\)</span>, where</p>
<p><span class="math display">\[SRR^{(0)} = \frac{\sum_{i = 1}^m \sum_{j = 1}^{n_i} \frac{e^{{\gamma}_0 + X_{ij}\beta}}{1 + e^{{\gamma}_0 + X_{ij}\beta}}}{\sum_{i = 1}^m O_i}.\]</span></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yubo Shao.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
